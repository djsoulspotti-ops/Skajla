<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKAJLA Connect - Opportunity Marketplace</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="/static/css/tokens.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f2 100%);
            min-height: 100vh;
        }

        /* Header */
        .marketplace-header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 1.5rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-title h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #111827;
        }

        .header-title .subtitle {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        .profile-completeness {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.25rem;
            background: linear-gradient(135deg, #003B73 0%, #0056a3 100%);
            color: white;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .progress-ring {
            width: 40px;
            height: 40px;
            position: relative;
        }

        /* Filter Section */
        .filter-section {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .filter-bar {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            margin-bottom: 2rem;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.25rem;
        }

        .filter-select, .filter-input {
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 0.875rem;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: #003B73;
            box-shadow: 0 0 0 3px rgba(0, 59, 115, 0.1);
        }

        .filter-chips {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .chip {
            padding: 0.5rem 1rem;
            background: #f3f4f6;
            border: 2px solid transparent;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .chip:hover {
            background: #e5e7eb;
        }

        .chip.active {
            background: linear-gradient(135deg, #003B73 0%, #0056a3 100%);
            color: white;
            border-color: #003B73;
        }

        /* Opportunity Cards */
        .opportunities-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem 4rem;
        }

        .opportunities-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .opportunities-count {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
        }

        .view-toggle {
            display: flex;
            gap: 0.5rem;
        }

        .view-btn {
            padding: 0.5rem 1rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .view-btn.active {
            background: #003B73;
            color: white;
            border-color: #003B73;
        }

        .opportunities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 1.5rem;
        }

        .opportunity-card {
            background: white;
            border-radius: 16px;
            padding: 1.75rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .opportunity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #003B73, #D4AF37);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .opportunity-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,59,115,0.15);
            border-color: #003B73;
        }

        .opportunity-card:hover::before {
            opacity: 1;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.25rem;
        }

        .company-logo {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #003B73 0%, #0056a3 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            flex-shrink: 0;
        }

        .card-content {
            flex: 1;
            margin-left: 1rem;
        }

        .company-name {
            font-size: 1.125rem;
            font-weight: 700;
            color: #111827;
            margin-bottom: 0.25rem;
        }

        .position-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: #003B73;
            margin-bottom: 0.5rem;
        }

        .tags-container {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .tag {
            padding: 0.375rem 0.75rem;
            background: #f3f4f6;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #374151;
        }

        .tag.pcto-certified {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .tag.remote {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }

        .tag.hybrid {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .opportunity-description {
            font-size: 0.875rem;
            color: #6b7280;
            line-height: 1.6;
            margin-bottom: 1.25rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .opportunity-meta {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.25rem;
            padding-top: 1rem;
            border-top: 1px solid #f3f4f6;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8125rem;
            color: #6b7280;
        }

        .meta-item i {
            color: #003B73;
            width: 16px;
        }

        .meta-item strong {
            color: #374151;
            font-weight: 600;
        }

        .card-footer {
            display: flex;
            gap: 0.75rem;
        }

        .btn-apply {
            flex: 1;
            padding: 0.875rem 1.5rem;
            background: linear-gradient(135deg, #003B73 0%, #0056a3 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-apply:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 59, 115, 0.3);
        }

        .btn-apply:active {
            transform: translateY(0);
        }

        .btn-apply.applied {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            cursor: default;
        }

        .btn-details {
            padding: 0.875rem 1.25rem;
            background: white;
            color: #003B73;
            border: 2px solid #003B73;
            border-radius: 10px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-details:hover {
            background: #003B73;
            color: white;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-state i {
            font-size: 4rem;
            color: #d1d5db;
            margin-bottom: 1rem;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #111827;
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            font-size: 1rem;
            color: #6b7280;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 4rem 2rem;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #f3f4f6;
            border-top-color: #003B73;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }

            .filter-grid {
                grid-template-columns: 1fr;
            }

            .opportunities-grid {
                grid-template-columns: 1fr;
            }

            .opportunity-meta {
                grid-template-columns: 1fr;
            }

            .opportunities-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }

        /* Back Button */
        .btn-back {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, #111827 0%, #374151 100%);
            color: white;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 600;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .btn-back:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="marketplace-header">
        <div class="header-content">
            <div class="header-title">
                <div>
                    <h1>üöÄ Opportunity Marketplace</h1>
                    <p class="subtitle">Zero Friction. Find your PCTO placement as easy as ordering food.</p>
                </div>
            </div>
            <div class="profile-completeness">
                <div class="progress-ring">
                    <svg width="40" height="40">
                        <circle cx="20" cy="20" r="16" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="4"/>
                        <circle cx="20" cy="20" r="16" fill="none" stroke="#D4AF37" stroke-width="4" 
                                stroke-dasharray="100" stroke-dashoffset="{{ 100 - profile_completeness }}"
                                transform="rotate(-90 20 20)" style="transition: stroke-dashoffset 0.5s ease;"/>
                    </svg>
                    <span style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 0.75rem; font-weight: 700;">
                        {{ profile_completeness }}%
                    </span>
                </div>
                <div>
                    <div style="font-weight: 700;">Profile: {{ profile_completeness }}%</div>
                    <div style="font-size: 0.75rem; opacity: 0.9;">Complete your portfolio</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
        <div class="filter-bar">
            <div class="filter-grid">
                <div class="filter-group">
                    <label class="filter-label">üîç Search</label>
                    <input type="text" class="filter-input" id="searchInput" placeholder="Search opportunities...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">üìç Location Type</label>
                    <select class="filter-select" id="locationFilter">
                        <option value="">All Locations</option>
                        <option value="on-site">On-Site</option>
                        <option value="remote">Remote</option>
                        <option value="hybrid">Hybrid</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">üè¢ Sector</label>
                    <select class="filter-select" id="sectorFilter">
                        <option value="">All Sectors</option>
                        <option value="tech">Technology</option>
                        <option value="marketing">Marketing</option>
                        <option value="finance">Finance</option>
                        <option value="design">Design & Creative</option>
                        <option value="energy">Energy & Sustainability</option>
                        <option value="biotech">Biotechnology</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">‚è∞ PCTO Hours</label>
                    <select class="filter-select" id="hoursFilter">
                        <option value="">All Durations</option>
                        <option value="40">40+ hours</option>
                        <option value="80">80+ hours</option>
                        <option value="120">120+ hours</option>
                    </select>
                </div>
            </div>
            <div class="filter-chips">
                <div class="chip active" data-filter="all">All Opportunities</div>
                <div class="chip" data-filter="pcto">‚úÖ PCTO Certified Only</div>
                <div class="chip" data-filter="remote">üåê Remote Friendly</div>
                <div class="chip" data-filter="paid">üí∞ Paid Positions</div>
            </div>
        </div>
    </div>

    <!-- Opportunities Container -->
    <div class="opportunities-container">
        <div class="opportunities-header">
            <div class="opportunities-count">
                <strong id="opportunityCount">{{ opportunities|length }}</strong> opportunities found
            </div>
        </div>

        <!-- Opportunities Grid -->
        <div class="opportunities-grid" id="opportunitiesGrid">
            {% if opportunities %}
                {% for opp in opportunities %}
                <div class="opportunity-card" 
                     data-location="{{ opp.location_type }}" 
                     data-sector="{{ opp.sector }}" 
                     data-pcto="{{ opp.pcto_certified }}"
                     data-hours="{{ opp.hours_required }}">
                    <div class="card-header">
                        <div class="company-logo">{{ opp.company_name[0]|upper }}</div>
                        <div class="card-content">
                            <h3 class="company-name">{{ opp.company_name }}</h3>
                            <div class="position-title">{{ opp.position_title }}</div>
                            <div class="tags-container">
                                {% if opp.pcto_certified %}
                                <span class="tag pcto-certified">‚úì PCTO Certified</span>
                                {% endif %}
                                {% if opp.location_type == 'remote' %}
                                <span class="tag remote">üåê Remote</span>
                                {% elif opp.location_type == 'hybrid' %}
                                <span class="tag hybrid">üè¢ Hybrid</span>
                                {% endif %}
                                <span class="tag">{{ opp.opportunity_type|upper }}</span>
                            </div>
                        </div>
                    </div>

                    <p class="opportunity-description">{{ opp.description }}</p>

                    <div class="opportunity-meta">
                        <div class="meta-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>{{ opp.city or 'Multiple Locations' }}</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-clock"></i>
                            <span><strong>{{ opp.hours_required }}</strong> hours</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-euro-sign"></i>
                            <span>{{ opp.compensation or 'PCTO Credits' }}</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-users"></i>
                            <span><strong>{{ opp.spots_available - opp.spots_filled }}</strong> spots left</span>
                        </div>
                    </div>

                    <div class="card-footer">
                        <button class="btn-apply" onclick="oneClickApply({{ opp.id }}, '{{ opp.company_name }}', '{{ opp.position_title }}')">
                            <i class="fas fa-paper-plane"></i>
                            Apply Now
                        </button>
                        <button class="btn-details" onclick="viewDetails({{ opp.id }})">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-briefcase"></i>
                    <h3>No Opportunities Yet</h3>
                    <p>Check back soon for new PCTO placements and internships!</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Back Button -->
    <a href="/dashboard" class="btn-back">
        <i class="fas fa-arrow-left"></i>
        <span>Back to Dashboard</span>
    </a>

    <script>
        // One-Click Apply Function
        async function oneClickApply(opportunityId, companyName, positionTitle) {
            const btn = event.target.closest('.btn-apply');
            
            if (btn.classList.contains('applied')) {
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';

            try {
                const response = await fetch('/api/opportunities/apply', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        opportunity_id: opportunityId
                    })
                });

                const data = await response.json();

                if (data.success) {
                    btn.classList.add('applied');
                    btn.innerHTML = '<i class="fas fa-check"></i> Applied!';
                    
                    // Show success notification
                    showNotification(`‚úÖ Application sent to ${companyName} for ${positionTitle}!`, 'success');
                } else {
                    throw new Error(data.message || 'Application failed');
                }
            } catch (error) {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-paper-plane"></i> Apply Now';
                showNotification(`‚ùå ${error.message}`, 'error');
            }
        }

        function viewDetails(opportunityId) {
            window.location.href = `/skaila-connect/opportunity/${opportunityId}`;
        }

        function showNotification(message, type) {
            // Simple toast notification
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 2rem;
                right: 2rem;
                padding: 1rem 1.5rem;
                background: ${type === 'success' ? '#10b981' : '#ef4444'};
                color: white;
                border-radius: 12px;
                box-shadow: 0 8px 16px rgba(0,0,0,0.2);
                z-index: 10000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Filtering Logic
        const cards = document.querySelectorAll('.opportunity-card');
        const searchInput = document.getElementById('searchInput');
        const locationFilter = document.getElementById('locationFilter');
        const sectorFilter = document.getElementById('sectorFilter');
        const hoursFilter = document.getElementById('hoursFilter');
        const filterChips = document.querySelectorAll('.chip');

        let activeFilters = {
            search: '',
            location: '',
            sector: '',
            hours: '',
            quickFilter: 'all'
        };

        function applyFilters() {
            let visibleCount = 0;

            cards.forEach(card => {
                let show = true;

                // Search filter
                if (activeFilters.search) {
                    const text = card.textContent.toLowerCase();
                    show = show && text.includes(activeFilters.search.toLowerCase());
                }

                // Location filter
                if (activeFilters.location) {
                    show = show && card.dataset.location === activeFilters.location;
                }

                // Sector filter
                if (activeFilters.sector) {
                    show = show && card.dataset.sector === activeFilters.sector;
                }

                // Hours filter
                if (activeFilters.hours) {
                    const hours = parseInt(card.dataset.hours) || 0;
                    show = show && hours >= parseInt(activeFilters.hours);
                }

                // Quick filters
                if (activeFilters.quickFilter === 'pcto') {
                    show = show && card.dataset.pcto === 'True';
                } else if (activeFilters.quickFilter === 'remote') {
                    show = show && (card.dataset.location === 'remote' || card.dataset.location === 'hybrid');
                } else if (activeFilters.quickFilter === 'paid') {
                    const text = card.textContent.toLowerCase();
                    show = show && (text.includes('‚Ç¨') || text.includes('paid'));
                }

                card.style.display = show ? 'block' : 'none';
                if (show) visibleCount++;
            });

            document.getElementById('opportunityCount').textContent = visibleCount;
        }

        searchInput.addEventListener('input', (e) => {
            activeFilters.search = e.target.value;
            applyFilters();
        });

        locationFilter.addEventListener('change', (e) => {
            activeFilters.location = e.target.value;
            applyFilters();
        });

        sectorFilter.addEventListener('change', (e) => {
            activeFilters.sector = e.target.value;
            applyFilters();
        });

        hoursFilter.addEventListener('change', (e) => {
            activeFilters.hours = e.target.value;
            applyFilters();
        });

        filterChips.forEach(chip => {
            chip.addEventListener('click', () => {
                filterChips.forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
                activeFilters.quickFilter = chip.dataset.filter;
                applyFilters();
            });
        });
    </script>
</body>
</html>
